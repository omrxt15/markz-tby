<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ø¨ÙŠ</title>
    
    <!-- ğŸ”¥ Ù…ÙƒØªØ¨Ø§Øª Firebase - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 8.10.0 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Firebase -->
    <script>
        // ÙƒÙˆØ¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù…Ù† Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAyMj45dlYmK7krr1h6gCm2gulkje3XEi0",
            authDomain: "markez-tby.firebaseapp.com",
            projectId: "markez-tby",
            storageBucket: "markez-tby.firebasestorage.app",
            messagingSenderId: "259672956938",
            appId: "1:259672956938:web:497a5bdd0c1f16432b7ff3"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const db = firebase.firestore();
        
        // ØªØ£Ø®ÙŠØ± Ø§Ù„Ø¹Ø±Ø¶ Ø­ØªÙ‰ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Firebase
        document.addEventListener('DOMContentLoaded', function() {
            console.log("âœ… Firebase connected! DB:", db);
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
            db.collection("doctors").get().then(snapshot => {
                console.log("âœ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", snapshot.size);
            }).catch(error => {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:", error);
            });
        });
    </script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Tajawal", sans-serif;
        }
        
        body {
            display: flex;
            min-height: 100vh;
            background: #f5f7fa;
        }
        
        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #0047ad, #003082);
            color: white;
            padding: 20px 0;
            box-shadow: 3px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar h2 {
            text-align: center;
            margin: 20px 0 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            font-size: 1.5rem;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar li {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .sidebar li:hover {
            background: rgba(255,255,255,0.1);

        }
        
        .sidebar li.active {
            background: rgba(255,255,255,0.15);

        }
        
        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        

        
        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© */
        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: white;
            padding: 25px;
            flex: 1;
            min-width: 200px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h3 {
            color: #0047ad;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .card span {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }
        
        /* Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        section h1 {
            color: #0047ad;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f0ff;
        }
        
        /* Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
        .form-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #0047ad;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 71, 173, 0.1);
        }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            background: #0047ad;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #003082;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 71, 173, 0.2);
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        /* Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .data-list {
            margin-top: 20px;
        }
        
        .data-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .data-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .data-info h4 {
            color: #0047ad;
            margin-bottom: 5px;
        }
        
        .data-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .data-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ */
        .doctors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .doctor-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .doctor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        
        .doctor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f5ff;
        }
        
        .doctor-name {
            color: #0047ad;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .doctor-specialization {
            background: #e8f0ff;
            color: #0047ad;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .doctor-details {
            margin-bottom: 15px;
        }
        
        .doctor-details div {
            margin: 8px 0;
            color: #555;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .doctor-details span {
            font-weight: 500;
            color: #333;
            min-width: 100px;
        }
        
        .doctor-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø®Ø·Ø£ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #0047ad;
            font-size: 1.1rem;
        }
        
        .error {
            color: #e74c3c;
            text-align: center;
            padding: 20px;
            background: #ffeaea;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .empty {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .sidebar ul {
                display: flex;
                overflow-x: auto;
                padding: 10px;
            }
            
            .sidebar li {
                white-space: nowrap;
            }
            
            .cards {
                flex-direction: column;
            }
            
            .doctors-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
</head>
<body>
    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <div class="sidebar">
        <h2>ğŸ¥ Ù…Ø±ÙƒØ² Ø·Ø¨ÙŠ</h2>
        <ul>
            <li onclick="showPage('dashboard')" class="active">ğŸ“Š Ø§Ù„Ø§Ø­ØµØ§Ø¦ÙŠØ§Øª</li>
            <li onclick="showPage('doctors')">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</li>
            <li onclick="showPage('appointments')">ğŸ“… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</li>
            
        </ul>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="content">
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
        <section id="dashboard" class="page active">
            <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="cards">
                <div class="card">
                    <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</h3>
                    <span id="statDoctors">0</span>
                </div>

                <div class="card">
                    <h3>Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
                    <span id="statAnalyses">0</span>
                </div>
                <div class="card">
                    <h3>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…</h3>
                    <span id="statAppointments">0</span>
                </div>

            </div>
        </section>



        <!-- Ù‚Ø³Ù… Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ -->
        <section id="doctors" class="page">
            <h1>ğŸ‘¨â€âš•ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</h1>
            
            <div class="form-container">
                <h3>Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯</h3>
                <form id="doctorForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨:</label>
                            <input type="text" id="doctorName" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ØªØ®ØµØµ:</label>
                            <input type="text" id="doctorSpecialization" required>
                        </div>
                        <div class="form-group">
                            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                            <input type="tel" id="doctorPhone" required>
                        </div>
                        <div class="form-group">
                            <label>Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø©:</label>
                            <input type="text" id="doctorexperience" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª:</label>
                            <input type="text" id="doctorcv">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù„ØºØ§Øª:</label>
                            <input type="text" id="doctorlanguages" value="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
                        </div>
                        <div class="form-group">
                            <label>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„:</label>
                            <input type="text" id="doctorplace" value="Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">
                        </div>
                        <div class="form-group">
                            <label>Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„:</label>
                            <input type="text" id="doctorworkdays" value="Ø§Ù„Ø³Ø¨Øª - Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡">
                        </div>
                        <div class="form-group">
                            <label>Ø³Ø¹Ø± Ø§Ù„ÙƒØ´Ù (Ø¬.Ù…):</label>
                            <input type="number" id="doctorprice" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success" style="margin-top: 20px;">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨ÙŠØ¨</button>
                </form>
            </div>
            
            <h3 style="margin-top: 30px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</h3>
            <div class="doctors-grid" id="doctorsContainer">
                <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ù‡Ù†Ø§ -->
            </div>
        </section>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ -->
        <section id="appointments" class="page">
            <h1>ğŸ“… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h1>
            <button class="btn" onclick="showAppointmentForm()">â• Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯</button>
            
            <div class="form-container" style="display:none;" id="appointmentFormContainer">
                <h3>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
                <form id="appointmentForm">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶:</label>
                        <input type="text" id="appointmentPatient" required>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨:</label>
                        <select id="appointmentDoctor" required></select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</label>
                        <input type="datetime-local" id="appointmentDateTime" required>
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„ÙƒØ´Ù:</label>
                        <input type="text" id="appointmentType" value="ÙƒØ´Ù Ø¹Ø§Ø¯ÙŠ">
                    </div>
                    <button type="submit" class="btn btn-success">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
                    <button type="button" class="btn btn-danger" onclick="hideAppointmentForm()">Ø¥Ù„ØºØ§Ø¡</button>
                </form>
            </div>
            
            <div class="data-list" id="appointmentsList">
                <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù‡Ù†Ø§ -->
            </div>
        </section>

        <!-- Ù‚Ø³Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->

    </div>

    <!-- JavaScript -->
<script>
    // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ ====================
    function showPage(pageId) {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        document.querySelectorAll('.sidebar li').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelector(`.sidebar li[onclick*="${pageId}"]`).classList.add('active');
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        document.getElementById(pageId).classList.add('active');
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©
        switch(pageId) {
            case 'doctors':
                loadDoctors();
                break;
            case 'patients':
                loadPatients();
                break;
            case 'appointments':
                loadAppointments();
                loadDoctorsForSelect();
                break;
            case 'bills':
                loadBills();
                break;
            case 'dashboard':
                updateStats();
                break;
        }
    }
    
    // ==================== Ù‚Ø³Ù… Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ ====================
    // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯
    document.getElementById("doctorForm").addEventListener("submit", async function(e){
        e.preventDefault();
        
        const doctorData = {
            name: document.getElementById("doctorName").value,
            specialization: document.getElementById("doctorSpecialization").value,
            phone: document.getElementById("doctorPhone").value,
            experience: document.getElementById("doctorexperience").value,
            cv: document.getElementById("doctorcv").value,
            languages: document.getElementById("doctorlanguages").value,
            place: document.getElementById("doctorplace").value,
            workdays: document.getElementById("doctorworkdays").value,
            pricee: document.getElementById("doctorprice").value,
            createdAt: new Date(),
            status: "active"
        };
        
        try {
            await db.collection("doctors").add(doctorData);
            alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­!");
            loadDoctors();
            document.getElementById("doctorForm").reset();
        } catch (error) {
            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message);
            console.error("Error adding doctor:", error);
        }
    });
    
    // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
    async function loadDoctors() {
        try {
            const container = document.getElementById("doctorsContainer");
            if (!container) {
                console.error("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ doctorsContainer");
                return;
            }
            
            container.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡...</div>';
            
            const snapshot = await db.collection("doctors")
                .orderBy("createdAt", "desc")
                .get();
            
            if (snapshot.empty) {
                container.innerHTML = '<div class="empty">ğŸ‘¨â€âš•ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø·Ø¨Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯</div>';
                return;
            }
            
            container.innerHTML = "";
            snapshot.forEach(doc => {
                const doctor = doc.data();
                const doctorId = doc.id;
                
                const doctorCard = `
                    <div class="doctor-card">
                        <div class="doctor-header">
                            <div class="doctor-name">${doctor.name}</div>
                            <div class="doctor-specialization">${doctor.specialization}</div>
                        </div>
                        <div class="doctor-details">
                            <div><span>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:</span> ${doctor.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
                            <div><span>ğŸ¯ Ø§Ù„Ø®Ø¨Ø±Ø©:</span> ${doctor.experience || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            <div><span>ğŸ“ Ø§Ù„Ù…ÙƒØ§Ù†:</span> ${doctor.place || 'Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ'}</div>
                            <div><span>ğŸ—“ï¸ Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„:</span> ${doctor.workdays || 'Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„'}</div>
                            <div><span>ğŸ’° Ø³Ø¹Ø± Ø§Ù„ÙƒØ´Ù:</span> ${doctor.pricee || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} Ø¬.Ù…</div>
                            <div><span>ğŸŒ Ø§Ù„Ù„ØºØ§Øª:</span> ${doctor.languages || 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'}</div>
                            <div><span>ğŸ“œ Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª:</span> ${doctor.cv || 'ØºÙŠØ± Ù…Ø±ÙÙ‚'}</div>
                        </div>
                        <div class="doctor-actions">
                            <button class="btn btn-danger" onclick="deleteDoctor('${doctorId}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
                
                container.innerHTML += doctorCard;
            });
            
            updateStats();
            
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡:", error);
            document.getElementById("doctorsContainer").innerHTML = 
                '<div class="error">âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</div>';
        }
    }
    
    // Ø­Ø°Ù Ø·Ø¨ÙŠØ¨
    async function deleteDoctor(doctorId) {
        if (!confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø¨ÙŠØ¨ØŸ")) return;
        
        try {
            await db.collection("doctors").doc(doctorId).delete();
            alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­");
            loadDoctors();
        } catch (error) {
            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù");
        }
    }
    
    // ==================== Ù‚Ø³Ù… Ø§Ù„Ù…Ø±Ø¶Ù‰ ====================
    function addPatient() {
        document.getElementById("patientFormContainer").style.display = "block";
    }
    
    function hidePatientForm() {
        document.getElementById("patientFormContainer").style.display = "none";
    }
    
    // ==================== Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ====================
    function showAppointmentForm() {
        document.getElementById("appointmentFormContainer").style.display = "block";
    }
    
    function hideAppointmentForm() {
        document.getElementById("appointmentFormContainer").style.display = "none";
    }
    
    async function loadDoctorsForSelect() {
        try {
            const select = document.getElementById("appointmentDoctor");
            select.innerHTML = '<option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>';
            
            const snapshot = await db.collection("doctors").get();
            
            if (snapshot.empty) {
                select.innerHTML = '<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø·Ø¨Ø§Ø¡</option>';
                return;
            }
            
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</option>';
            snapshot.forEach(doc => {
                const doctor = doc.data();
                select.innerHTML += `<option value="${doctor.name}">${doctor.name} - ${doctor.specialization}</option>`;
            });
        } catch (error) {
            console.error("Error loading doctors for select:", error);
        }
    }
    
    // ==================== Ù‚Ø³Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± ====================
    function showBillForm() {
        document.getElementById("billFormContainer").style.display = "block";
    }
    
    function hideBillForm() {
        document.getElementById("billFormContainer").style.display = "none";
    }
    
    // ==================== Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ====================
// ==================== Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ====================
async function updateStats() {
  try {
    console.log("ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...");
    
    // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
    const doctorsSnapshot = await db.collection("doctors").get();
    const doctorsCount = doctorsSnapshot.size;
    document.getElementById("statDoctors").textContent = doctorsCount;
    
    // Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
    const appointmentsSnapshot = await db.collection("appointments").get();
    const appointmentsCount = appointmentsSnapshot.size;
    document.getElementById("statAppointments").textContent = appointmentsCount;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    let totalAnalyses = 0;
    const patientsSet = new Set();
    
    appointmentsSnapshot.forEach(doc => {
      const app = doc.data();
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„
      if (app.analyses && Array.isArray(app.analyses)) {
        totalAnalyses += app.analyses.length;
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„ÙØ±ÙŠØ¯ÙŠÙ†
      if (app.patientName && app.patientPhone) {
        patientsSet.add(`${app.patientName}-${app.patientPhone}`);
      }
    });
    
    document.getElementById("statAnalyses").textContent = totalAnalyses;
    document.getElementById("statPatients").textContent = patientsSet.size;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
    let totalRevenue = 0;
    
    // 1. Ø­Ø³Ø§Ø¨ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØ´ÙˆÙØ§Øª Ù…Ù† Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
    const doctorsMap = {};
    doctorsSnapshot.forEach(doc => {
      const doctor = doc.data();
      if (doctor.name && doctor.pricee) {
        doctorsMap[doctor.name] = parseInt(doctor.pricee) || 0;
      }
    });
    
    // 2. Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„ÙƒÙ„ Ø·Ø¨ÙŠØ¨ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¹Ø±
    appointmentsSnapshot.forEach(doc => {
      const app = doc.data();
      if (app.doctor && doctorsMap[app.doctor]) {
        totalRevenue += doctorsMap[app.doctor];
      }
      
      // 3. Ø¥Ø¶Ø§ÙØ© Ø³Ø¹Ø± Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ (Ø§ÙØªØ±Ø§Ø¶ÙŠ 50 Ù„ÙƒÙ„ ØªØ­Ù„ÙŠÙ„)
      if (app.analyses && Array.isArray(app.analyses)) {
        totalRevenue += app.analyses.length * 50;
      }
    });
    
    document.getElementById("statMoney").textContent = totalRevenue.toLocaleString();
    
    console.log("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:");
    console.log("- Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡:", doctorsCount);
    console.log("- Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯:", appointmentsCount);
    console.log("- Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„:", totalAnalyses);
    console.log("- Ø§Ù„Ù…Ø±Ø¶Ù‰:", patientsSet.size);
    console.log("- Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:", totalRevenue);
    
  } catch (error) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:", error);
  }
}
    

    document.addEventListener("DOMContentLoaded", function() {
        console.log("ğŸ“± ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©");
        updateStats();
    });
    
    async function loadPatients() {
        document.getElementById("patientsList").innerHTML = 
            '<div class="empty">ğŸ‘¥ Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹</div>';
    }
    
async function loadAppointments() {
  const list = document.getElementById("appointmentsList");
  list.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯...</div>';

  try {
    const snapshot = await db.collection("appointments").orderBy("createdAt", "desc").get();

    if (snapshot.empty) {
      list.innerHTML = '<div class="empty">ğŸ“… Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>';
      return;
    }

    list.innerHTML = "";
    snapshot.forEach(doc => {
      const app = doc.data();
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù†Øµ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„
      let analysesHTML = '';
      if (app.analyses && app.analyses.length > 0) {
        analysesHTML = `
          <p>ğŸ§ª Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</p>
          <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;">
            ${app.analyses.map(analysis => 
              `<span style="background: #e8f0ff; color: #0047ad; padding: 3px 8px; border-radius: 12px; font-size: 12px;">${analysis}</span>`
            ).join('')}
          </div>
        `;
      }

      const card = `
        <div class="data-item">
          <div class="data-info">
            <h4>ğŸ‘¤ ${app.patientName} 
              ${app.analysesCount > 0 ? 
                `<span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-right: 10px;">${app.analysesCount} ØªØ­Ù„ÙŠÙ„</span>` 
                : ''}
            </h4>
            <p>ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨: ${app.doctor}</p>
            <p>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${app.date} - ${app.time}</p>
            <p>ğŸ©º Ø§Ù„ØªØ®ØµØµ: ${app.specialty}</p>
            <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${app.patientPhone}</p>
            ${analysesHTML}
            <p style="color: #888; font-size: 12px; margin-top: 8px;">
              â° ØªÙ… Ø§Ù„Ø­Ø¬Ø² ÙÙŠ: ${new Date(app.createdAt?.toDate()).toLocaleString('ar-EG')}
            </p>
          </div>
          <div class="data-actions">
            <button class="btn btn-danger" onclick="deleteAppointment('${doc.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          </div>
        </div>
      `;
      list.innerHTML += card;
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
    updateStats();

  } catch (error) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯:", error);
    list.innerHTML = '<div class="error">âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>';
  }
}

async function deleteAppointment(id) {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ØŸ")) return;
    await db.collection("appointments").doc(id).delete();
    loadAppointments();
}
    

    
    function editDoctor(doctorId) {
        alert(` ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ¨ (${doctorId}) - Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±`);
    }
</script>
</body>
</html>